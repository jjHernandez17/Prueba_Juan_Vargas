@model IEnumerable<JuanJoseVargas.Models.Appointment>

<style>
    body {
        background-color: #1f1b2e;
        color: #f8f9fa;
    }
    .table thead {
        background-color: #6f42c1;
        color: white;
    }
    .btn-purple {
        background-color: #6f42c1;
        color: white;
    }
    .btn-purple:hover {
        background-color: #5a32a3;
        color: white;
    }
</style>

<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">
            <i class="bi bi-calendar-event me-2"></i>Gestión de Citas Médicas
        </h2>
        <a asp-controller="Appointment" asp-action="Create" class="btn btn-purple">Nueva Cita</a>
    </div>

    <!-- Filtros -->
    <form class="row g-3 mb-4">
        <div class="col-md-4">
            <label class="form-label">Filtrar por Paciente</label>
            <select class="form-select">
                <option value="">Todos</option>
                <option>Paciente 1</option>
                <option>Paciente 2</option>
            </select>
        </div>
        <div class="col-md-4">
            <label class="form-label">Filtrar por Médico</label>
            <select class="form-select">
                <option value="">Todos</option>
                <option>Dr. García</option>
                <option>Dra. López</option>
            </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-purple w-50 me-2">
                <i class="bi bi-search"></i> Buscar
            </button>
            <button type="reset" class="btn btn-secondary w-50">
                <i class="bi bi-arrow-counterclockwise"></i> Limpiar
            </button>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle text-center">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Paciente</th>
                    <th>Médico</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Correo</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var a in Model)
            {
                <tr>
                    <td>@a.Id</td>
                    <td>@a.Patient.FullName</td>
                    <td>@a.Doctor.FullName</td>
                    <td>@a.AppointmentDate</td>
                    <td>
                        @if (a.Status == JuanJoseVargas.Models.AppointmentStatus.Scheduled)
                        {
                            <span class="badge bg-primary">Programada</span>
                        }
                        else if (a.Status == JuanJoseVargas.Models.AppointmentStatus.Attended)
                        {
                            <span class="badge bg-success">Atendida</span>
                        }
                        else if (a.Status == JuanJoseVargas.Models.AppointmentStatus.Canceled)
                        {
                            <span class="badge bg-danger">Cancelada</span>
                        }
                    </td>

                    <!-- Correo -->
                    <td>
                        @if (a.EmailLogs != null && a.EmailLogs.Any(e => e.Status == JuanJoseVargas.Models.EmailStatus.Sent))
                        {
                            <button class="btn btn-sm btn-secondary" disabled>
                                <i class="bi bi-check-circle-fill"></i> Enviado
                            </button>
                        }
                        else
                        {
                            <form asp-controller="Appointment" asp-action="SendEmail" method="post" style="display:inline;">
                                <input type="hidden" name="appointmentId" value="@a.Id" />
                                <button type="submit" class="btn btn-sm btn-outline-success" title="Enviar correo al paciente">
                                    <i class="bi bi-envelope-fill"></i> Enviar
                                </button>
                            </form>
                        }
                    </td>

                    <td>
                        <a asp-controller="Appointment" asp-action="Edit" asp-route-id="@a.Id" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    </div>
</div>
